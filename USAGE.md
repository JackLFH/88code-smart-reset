# 88code Chrome 扩展 - 使用指南

## 🚀 快速开始

### 1. 安装扩展

#### 开发模式（加载未打包的扩展）

1. **构建项目**
   ```bash
   npm install
   npm run build
   ```

2. **加载到 Chrome**
   - 打开 Chrome 浏览器
   - 访问 `chrome://extensions/`
   - 打开右上角的「开发者模式」
   - 点击「加载已解压的扩展程序」
   - 选择项目的 `dist` 目录

3. **验证安装**
   - 扩展图标应该出现在 Chrome 工具栏
   - 点击图标打开 Popup 界面

---

### 2. 配置 API 密钥

1. **获取 88code API 密钥**
   - 登录你的 88code 账号
   - 前往个人设置 → API 密钥
   - 生成新的 API 密钥并复制

2. **在扩展中配置**
   - 点击扩展图标 → 「设置」按钮
   - 或右键点击扩展图标 → 「选项」
   - 填写账号名称（自定义，如"我的主账号"）
   - 粘贴 API 密钥
   - 点击「保存配置」

3. **测试连接**
   - 点击「测试连接」按钮
   - 如果显示「连接成功」，配置完成
   - 如果失败，请检查 API 密钥是否正确

---

### 3. 设置定时重置

1. **进入设置页面**
   - 打开扩展选项页
   - 切换到「定时设置」标签

2. **配置重置时间**
   - **首次重置时间**：默认 18:50（可自定义）
   - **二次重置时间**：默认 23:55（可自定义）
   - 勾选「启用自动重置」
   - 勾选「启用通知」（可选）

3. **保存设置**
   - 点击「保存设置」按钮
   - 扩展将在设定的时间自动执行重置

---

## 📖 功能说明

### Popup 界面

#### 容量显示
- **圆形进度条**：实时显示当前使用量百分比
- **使用详情**：
  - 已用：已使用的流量（GB）
  - 总量：总配额（GB）
  - 剩余：剩余配额（GB）

#### 操作按钮
- **立即重置**：手动触发重置操作
- **设置**：打开扩展选项页面

#### 状态指示
- **连接状态**：
  - 🟢 已连接：API 密钥有效
  - ⚪ 未连接：未配置或API密钥无效
- **下次重置时间**：显示下一次自动重置的时间

---

### Options 页面

#### API 配置 Tab
- **账号管理**：添加、编辑 88code 账号
- **API 密钥**：安全加密存储（AES-256-GCM）
- **连接测试**：验证 API 密钥有效性

#### 定时设置 Tab
- **首次重置时间**：设置每天第一次重置的时间
- **二次重置时间**：设置每天第二次重置的时间
- **自动重置开关**：启用/禁用自动重置功能
- **通知开关**：启用/禁用桌面通知

#### 日志记录 Tab
- **操作日志**：查看所有重置操作记录
- **日志级别**：
  - ℹ️ INFO：一般信息
  - ✅ SUCCESS：成功操作
  - ⚠️ WARNING：警告信息
  - ❌ ERROR：错误信息
- **日志管理**：
  - 刷新：重新加载日志
  - 清空：删除所有日志记录

---

## 🔒 安全特性

### 数据加密
- **API 密钥加密**：使用 AES-256-GCM 算法
- **密钥派生**：PBKDF2 算法（100,000 次迭代）
- **本地存储**：所有数据仅保存在本地浏览器

### API 通信安全
- **HTTPS 强制**：所有 API 请求使用 HTTPS
- **HMAC 签名**：请求使用 HMAC-SHA256 签名验证
- **速率限制**：每分钟最多 10 次请求（令牌桶算法）

### 隐私保护
- **日志脱敏**：自动过滤 API 密钥、邮箱等敏感信息
- **最小权限**：仅请求必要的 Chrome 权限
- **无追踪**：不收集任何用户数据

---

## ⚠️ 重要提示

### PAYGO 订阅保护
扩展内置「双重 PAYGO 保护机制」：
- ✅ 仅重置 MONTHLY 类型订阅
- ❌ 自动跳过 PAYGO 类型订阅
- 🛡️ 防止意外重置按量付费订阅

### 重置验证
每次重置后自动验证：
- ✓ 使用量是否减少
- ✓ 重置次数是否更新
- 只有双重验证通过才标记为成功

### 定时任务说明
- Chrome 的 Alarms API 精度约为 ±1 分钟
- Service Worker 可能被系统终止，但 Alarms 会重新唤醒
- 定时任务不受浏览器关闭影响

---

## 🐛 常见问题

### Q1: 提示「未连接」？
**A:** 检查以下几点：
1. API 密钥是否正确
2. 网络连接是否正常
3. 88code 服务是否可用

### Q2: 定时重置没有执行？
**A:** 可能的原因：
1. 「启用自动重置」未勾选
2. 今天已经执行过该时段的重置
3. 检查日志记录中是否有错误信息

### Q3: 提示「请求过于频繁」？
**A:** 触发了速率限制（10次/分钟），请等待 1 分钟后重试

### Q4: 如何查看详细错误？
**A:**
1. 打开扩展选项页
2. 切换到「日志记录」标签
3. 查看 ERROR 级别的日志

### Q5: 如何卸载扩展？
**A:**
1. 访问 `chrome://extensions/`
2. 找到「88code 自动重置助手」
3. 点击「移除」按钮
4. 所有本地数据将被清除

---

## 🔧 开发调试

### 查看扩展日志
```bash
# 打开 Chrome 开发者工具
chrome://extensions/ → 88code 助手 → 「背景页」→ 「Service Worker」→ 「inspect」
```

### 构建命令
```bash
# 开发模式
npm run dev

# 生产构建
npm run build

# 类型检查
npm run type-check

# 代码检查
npm run lint
```

### 目录结构
```
dist/
├── background/           # Service Worker
│   └── service-worker.js
├── popup/                # Popup界面
│   ├── popup.html
│   └── popup.js
├── options/              # Options页面
│   ├── options.html
│   └── options.js
├── assets/               # CSS和其他资源
├── icons/                # 图标文件
└── manifest.json         # 扩展配置
```

---

## 📞 支持与反馈

- **GitHub**: [https://github.com/Vulpecula-Studio/88code_reset](https://github.com/Vulpecula-Studio/88code_reset)
- **问题反馈**: 在 GitHub 提交 Issue
- **作者**: Half open flowers

---

## 📝 更新日志

### v1.0.0 (2025-10-29)
- ✨ 首次发布
- ✅ 自动定时重置功能
- ✅ 手动重置功能
- ✅ 实时容量可视化
- ✅ 双重 PAYGO 保护
- ✅ 企业级安全加密
- ✅ 完整日志记录

---

**⚠️ 免责声明**：本扩展为个人项目，非 88code 官方产品。使用前请确保理解代码逻辑。作者不对因使用本扩展造成的任何损失负责。
